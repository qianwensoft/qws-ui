# QWS-UI

åŸºäº React + TypeScript çš„ä¼ä¸šçº§æ•°æ®ç®¡ç†å¹³å°ï¼ŒåŒ…å«é«˜çº§è¡¨æ ¼ç»„ä»¶å’Œæ‰“å°è®¾è®¡å™¨ã€‚

## ğŸ“¦ ç»„ä»¶åˆ—è¡¨

### 1. é«˜çº§è¡¨æ ¼ç»„ä»¶ (AdvancedTable)
åŸºäº `@tanstack/react-table` å’Œ `@dnd-kit` å®ç°çš„åŠŸèƒ½ä¸°å¯Œçš„è¡¨æ ¼ç»„ä»¶ã€‚

### 2. æ‰“å°è®¾è®¡å™¨ (PrintDesigner)
åŸºäº `fabric.js` å®ç°çš„å¯è§†åŒ–æ‰“å°æ¨¡æ¿è®¾è®¡å™¨ã€‚

---

## âœ¨ é«˜çº§è¡¨æ ¼ - ä¸»è¦ç‰¹æ€§

### ğŸ“ æ•°æ®ç¼–è¾‘
- **å•å‡»ç¼–è¾‘æ¨¡å¼**ï¼šå•å‡»å•å…ƒæ ¼ç›´æ¥è¿›å…¥ç¼–è¾‘
- **åŒå‡»ç¼–è¾‘æ¨¡å¼**ï¼šåŒå‡»è¿›å…¥ç¼–è¾‘ï¼Œæ˜¾ç¤ºç¡®è®¤/å–æ¶ˆæŒ‰é’®
- **è‡ªåŠ¨ä¿å­˜**ï¼šå¤±ç„¦è‡ªåŠ¨ä¿å­˜ï¼ˆå¯é€‰ï¼‰
- **åˆ—çº§ç¼–è¾‘æ§åˆ¶**ï¼šå¯å•ç‹¬ç¦ç”¨æŸäº›åˆ—çš„ç¼–è¾‘åŠŸèƒ½

### ğŸ“‹ Excel ç²˜è´´
- æ”¯æŒä» Excelã€Google Sheets ç­‰å¤åˆ¶å¤šè¡Œå¤šåˆ—æ•°æ®
- æŒ‰æ‰€è§å³æ‰€å¾—çš„é¡ºåºå¡«å……ï¼ˆå…ˆæ¨ªå‘åçºµå‘ï¼‰
- è‡ªåŠ¨åˆ›å»ºæ–°è¡Œï¼ˆå½“ç²˜è´´æ•°æ®è¶…å‡ºç°æœ‰è¡Œæ•°æ—¶ï¼‰
- å®æ—¶å˜æ›´è¿½è¸ªå’Œå›è°ƒ

### ğŸ” åˆ—è¿‡æ»¤
- 12 ç§è¿‡æ»¤æ“ä½œç¬¦ï¼ˆç­‰äºã€å¤§äºã€å°äºã€åŒ…å«ç­‰ï¼‰
- æ”¯æŒå¤šæ¡ä»¶è¿‡æ»¤ï¼ˆAND é€»è¾‘ï¼‰
- å®¢æˆ·ç«¯è¿‡æ»¤æˆ–æœåŠ¡ç«¯è¿‡æ»¤ï¼ˆé€šè¿‡å›è°ƒå®ç°ï¼‰

### ğŸ“Š å¯¼å‡ºåŠŸèƒ½
- å¯¼å‡ºåˆ° Excelï¼ˆ.xlsx æ ¼å¼ï¼‰
- ä¸‰ç§å¯¼å‡ºèŒƒå›´ï¼šå½“å‰é¡µã€è¿‡æ»¤åæ•°æ®ã€å…¨éƒ¨æ•°æ®
- ä¿ç•™è¡¨æ ¼æ ·å¼ï¼ˆè¡¨å¤´ã€æ–‘é©¬çº¹ã€è¾¹æ¡†ç­‰ï¼‰

### ğŸ¯ åˆ—ç®¡ç†
- **æ‹–æ‹½æ’åº**ï¼šæ‹–åŠ¨åˆ—å¤´å·¦ä¾§å›¾æ ‡è°ƒæ•´åˆ—é¡ºåº
- **è°ƒæ•´å®½åº¦**ï¼šæ‹–åŠ¨åˆ—å¤´å³ä¾§è¾¹ç•Œçº¿
- **æ˜¾ç¤º/éšè—**ï¼šé€šè¿‡åˆ—è®¾ç½®å¼¹çª—æ§åˆ¶

### ğŸ“„ åˆ†é¡µåŠŸèƒ½
- é¡µç å¯¼èˆªï¼ˆé¦–é¡µã€ä¸Šä¸€é¡µã€ä¸‹ä¸€é¡µã€æœ«é¡µï¼‰
- æ¯é¡µæ¡æ•°é€‰æ‹©
- å¿«é€Ÿè·³è½¬åˆ°æŒ‡å®šé¡µ

### ğŸ¨ è§†è§‰æ•ˆæœ
- æ–‘é©¬çº¹è¡Œï¼ˆå¯è‡ªå®šä¹‰é¢œè‰²ï¼‰
- äº¤å‰é«˜äº®ï¼ˆè¡Œåˆ—äº¤å‰ç‚¹çªå‡ºæ˜¾ç¤ºï¼‰
- å¤šé€‰å•å…ƒæ ¼ï¼ˆæ‹–æ‹½é€‰æ‹©ï¼‰
- å¯è‡ªå®šä¹‰é€‰ä¸­è¾¹æ¡†é¢œè‰²

### ğŸ› ï¸ å·¥å…·æ 
- **è‡ªå®šä¹‰æŒ‰é’®**ï¼šåœ¨å·¥å…·æ å·¦ä¾§æ·»åŠ ä¸šåŠ¡ç›¸å…³çš„æ“ä½œæŒ‰é’®
- **ç³»ç»ŸæŒ‰é’®**ï¼šå¯¼å‡ºå’Œåˆ—è®¾ç½®å›ºå®šåœ¨å·¥å…·æ å³ä¾§
- **çµæ´»é…ç½®**ï¼šæ”¯æŒå›¾æ ‡ã€æ–‡æœ¬ã€ç¦ç”¨çŠ¶æ€ã€ç‚¹å‡»äº‹ä»¶ç­‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
yarn install
# æˆ–
npm install
```

### è¿è¡Œ Storybookï¼ˆæ¨èï¼‰

#### æ–¹å¼ 1ï¼šå¼€å‘æ¨¡å¼ï¼ˆæ¨èï¼‰

```bash
yarn storybook
# æˆ–
npm run storybook
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:6006

> **æ³¨æ„**ï¼šå¦‚æœé‡åˆ°ç½‘ç»œæ¥å£é”™è¯¯ï¼Œè¯·ä½¿ç”¨æ–¹å¼ 2ã€‚

#### æ–¹å¼ 2ï¼šæ„å»ºé™æ€ç‰ˆæœ¬

```bash
# æ„å»ºé™æ€æ–‡ä»¶
yarn build-storybook
# æˆ–
npm run build-storybook

# ä½¿ç”¨ä»»æ„é™æ€æœåŠ¡å™¨æŸ¥çœ‹ï¼Œä¾‹å¦‚ï¼š
npx serve storybook-static
```

### è¿è¡Œå¼€å‘ç¯å¢ƒ

```bash
yarn dev
# æˆ–
npm run dev
```

## ğŸ“š Storybook ç¤ºä¾‹

é¡¹ç›®å·²é…ç½®å®Œæ•´çš„ Storybookï¼ŒåŒ…å« 10 ä¸ªç¤ºä¾‹ï¼š

1. **Basic** - åŸºç¡€è¡¨æ ¼
2. **Edit Mode** - å•å‡»ç¼–è¾‘æ¨¡å¼
3. **Double Click Edit** - åŒå‡»ç¼–è¾‘æ¨¡å¼
4. **Excel Paste** - Excel ç²˜è´´åŠŸèƒ½
5. **Filtering** - åˆ—è¿‡æ»¤åŠŸèƒ½
6. **Pagination** - åˆ†é¡µåŠŸèƒ½
7. **Column Management** - åˆ—ç®¡ç†åŠŸèƒ½
8. **Custom Styling** - è‡ªå®šä¹‰æ ·å¼
9. **Full Featured** - å®Œæ•´åŠŸèƒ½ç¤ºä¾‹
10. **Large Dataset** - å¤§æ•°æ®é›†ç¤ºä¾‹
11. **Toolbar Buttons** â­ - å·¥å…·æ è‡ªå®šä¹‰æŒ‰é’®ï¼ˆæ–°å¢ï¼‰

æ¯ä¸ªç¤ºä¾‹éƒ½æœ‰è¯¦ç»†çš„è¯´æ˜å’Œäº¤äº’æ¼”ç¤ºã€‚

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```tsx
import { AdvancedTable } from './components/AdvancedTable';
import type { ColumnDef } from '@tanstack/react-table';

interface Person {
  id: string;
  name: string;
  age: number;
  email: string;
}

const columns: ColumnDef<Person>[] = [
  { id: 'name', accessorKey: 'name', header: 'å§“å' },
  { id: 'age', accessorKey: 'age', header: 'å¹´é¾„' },
  { id: 'email', accessorKey: 'email', header: 'é‚®ç®±' },
];

const data: Person[] = [
  { id: '1', name: 'å¼ ä¸‰', age: 28, email: 'zhangsan@example.com' },
  { id: '2', name: 'æå››', age: 32, email: 'lisi@example.com' },
];

function App() {
  const [tableData, setTableData] = useState(data);

  return (
    <AdvancedTable
      data={tableData}
      columns={columns}
      onDataChange={setTableData}
      enableEditing={true}
      enablePaste={true}
      enableFiltering={true}
      enableExport={true}
    />
  );
}
```

### å®Œæ•´åŠŸèƒ½é…ç½®

```tsx
// å·¥å…·æ è‡ªå®šä¹‰æŒ‰é’®
const toolbarButtons = [
  {
    key: 'add',
    label: 'æ–°å¢',
    icon: <PlusIcon />,
    onClick: () => {
      // æ·»åŠ æ–°è®°å½•
      const newRecord = { /* ... */ };
      setData([...data, newRecord]);
    },
  },
  {
    key: 'delete',
    label: 'åˆ é™¤',
    icon: <TrashIcon />,
    onClick: () => {
      // åˆ é™¤é€‰ä¸­çš„è®°å½•
    },
    disabled: selectedRows.length === 0,
  },
];

<AdvancedTable
  data={data}
  columns={columns}
  // å·¥å…·æ æŒ‰é’®
  toolbarButtons={toolbarButtons}
  // æ•°æ®å˜æ›´å›è°ƒ
  onDataChange={(newData, changeInfo) => {
    console.log('å˜æ›´ç±»å‹:', changeInfo?.type); // 'edit' æˆ– 'paste'
    console.log('å˜æ›´çš„å•å…ƒæ ¼:', changeInfo?.changes);
    setData(newData);
  }}
  // è¿‡æ»¤å›è°ƒ
  onFilterChange={(columnId, filters, allFilters) => {
    console.log('è¿‡æ»¤æ¡ä»¶:', allFilters);
  }}
  // é€‰æ‹©å˜åŒ–å›è°ƒ
  onSelectionChange={(selection) => {
    console.log('é€‰ä¸­çš„å•å…ƒæ ¼:', selection?.cells);
  }}
  // ç¼–è¾‘åŠŸèƒ½
  enableEditing={true}
  editTriggerMode="click"  // 'click' æˆ– 'doubleClick'
  autoSave={true}
  // å…¶ä»–åŠŸèƒ½
  enablePaste={true}
  enableFiltering={true}
  enableExport={true}
  enableColumnReorder={true}
  // åˆ†é¡µé…ç½®
  enablePagination={true}
  pagination={{
    pageIndex: 0,
    pageSize: 10,
    totalCount: data.length,
  }}
  onPageChange={setPageIndex}
  onPageSizeChange={setPageSize}
  // æ ·å¼å®šåˆ¶
  enableZebraStripes={true}
  enableCrossHighlight={true}
  zebraStripeColor="#fafafa"
  crossHighlightColor="#e6f7ff"
  selectedBorderColor="#1890ff"
/>
```

### ç¦ç”¨æŸåˆ—çš„ç¼–è¾‘

```tsx
const columns: ColumnDef<Person>[] = [
  { id: 'name', accessorKey: 'name', header: 'å§“å' },
  {
    id: 'email',
    accessorKey: 'email',
    header: 'é‚®ç®±',
    meta: {
      editable: false,  // ç¦ç”¨æ­¤åˆ—çš„ç¼–è¾‘
    },
  },
];
```

### å·¥å…·æ è‡ªå®šä¹‰æŒ‰é’®

```tsx
import { Plus, Trash2, RefreshCw } from 'lucide-react';

const toolbarButtons = [
  {
    key: 'add',
    label: 'æ–°å¢',
    icon: <Plus size={16} />,
    onClick: () => {
      // æ·»åŠ æ–°è®°å½•
      const newRecord = { /* ... */ };
      setData([...data, newRecord]);
    },
    title: 'æ·»åŠ æ–°è®°å½•',
  },
  {
    key: 'delete',
    label: 'åˆ é™¤',
    icon: <Trash2 size={16} />,
    onClick: () => {
      // åˆ é™¤é€‰ä¸­çš„è®°å½•
      if (confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
        // åˆ é™¤é€»è¾‘
      }
    },
    disabled: selectedRows.length === 0,
    title: 'åˆ é™¤é€‰ä¸­çš„è®°å½•',
  },
  {
    key: 'refresh',
    label: 'åˆ·æ–°',
    icon: <RefreshCw size={16} />,
    onClick: () => {
      // åˆ·æ–°æ•°æ®
      fetchData();
    },
    title: 'åˆ·æ–°æ•°æ®',
  },
];

<AdvancedTable
  data={data}
  columns={columns}
  toolbarButtons={toolbarButtons}  // æ·»åŠ å·¥å…·æ æŒ‰é’®
  enableEditing={true}
  enableExport={true}
  enableColumnReorder={true}
/>
```

**ToolbarButton æ¥å£ï¼š**
```typescript
interface ToolbarButton {
  key: string;              // å”¯ä¸€é”®
  label: React.ReactNode;   // æŒ‰é’®æ–‡æœ¬
  onClick: () => void;      // ç‚¹å‡»äº‹ä»¶
  icon?: React.ReactNode;   // å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
  disabled?: boolean;       // ç¦ç”¨çŠ¶æ€ï¼ˆå¯é€‰ï¼‰
  title?: string;           // æ‚¬åœæç¤ºï¼ˆå¯é€‰ï¼‰
}
```

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **React 18+**
- **TypeScript**
- **Vite**
- **@tanstack/react-table** - è¡¨æ ¼çŠ¶æ€ç®¡ç†
- **@dnd-kit** - æ‹–æ‹½åŠŸèƒ½
- **ExcelJS** - Excel å¯¼å‡º
- **lucide-react** - å›¾æ ‡åº“
- **Storybook** - ç»„ä»¶æ–‡æ¡£å’Œç¤ºä¾‹

## ğŸ“– API æ–‡æ¡£

### Props

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `data` | `T[]` | å¿…å¡« | è¡¨æ ¼æ•°æ® |
| `columns` | `ColumnDef<T>[]` | å¿…å¡« | åˆ—å®šä¹‰ |
| `onDataChange` | `(data: T[], changeInfo?: DataChangeInfo<T>) => void` | - | æ•°æ®å˜æ›´å›è°ƒ |
| `onFilterChange` | `OnFilterChange` | - | è¿‡æ»¤å˜æ›´å›è°ƒ |
| `onSelectionChange` | `(selection: SelectionRangeInfo \| null) => void` | - | é€‰æ‹©å˜æ›´å›è°ƒ |
| `enableEditing` | `boolean` | `true` | å¯ç”¨ç¼–è¾‘åŠŸèƒ½ |
| `editTriggerMode` | `'click' \| 'doubleClick'` | `'doubleClick'` | ç¼–è¾‘è§¦å‘æ¨¡å¼ |
| `autoSave` | `boolean` | `false` | è‡ªåŠ¨ä¿å­˜ï¼ˆå¤±ç„¦ä¿å­˜ï¼‰ |
| `enablePaste` | `boolean` | `true` | å¯ç”¨ç²˜è´´åŠŸèƒ½ |
| `enableFiltering` | `boolean` | `true` | å¯ç”¨è¿‡æ»¤åŠŸèƒ½ |
| `enableExport` | `boolean` | `true` | å¯ç”¨å¯¼å‡ºåŠŸèƒ½ |
| `enableColumnReorder` | `boolean` | `false` | å¯ç”¨åˆ—æ’åºåŠŸèƒ½ |
| `toolbarButtons` | `ToolbarButton[]` | `[]` | å·¥å…·æ å·¦ä¾§çš„è‡ªå®šä¹‰æŒ‰é’® |
| `enablePagination` | `boolean` | `false` | å¯ç”¨åˆ†é¡µåŠŸèƒ½ |
| `enableZebraStripes` | `boolean` | `true` | å¯ç”¨æ–‘é©¬çº¹ |
| `enableCrossHighlight` | `boolean` | `true` | å¯ç”¨äº¤å‰é«˜äº® |
| `zebraStripeColor` | `string` | `'#fafafa'` | æ–‘é©¬çº¹é¢œè‰² |
| `crossHighlightColor` | `string` | `'#e6f7ff'` | äº¤å‰é«˜äº®é¢œè‰² |
| `selectedBorderColor` | `string` | `'#1890ff'` | é€‰ä¸­è¾¹æ¡†é¢œè‰² |

æ›´å¤šè¯¦ç»†çš„ API æ–‡æ¡£è¯·å‚è€ƒ Storybookã€‚

## ğŸ¯ æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–
- å¯¹äºå¤§æ•°æ®é›†ï¼ˆ>1000 è¡Œï¼‰ï¼Œå»ºè®®å¯ç”¨åˆ†é¡µ
- ä½¿ç”¨ `React.memo` åŒ…è£¹è¡¨æ ¼ç»„ä»¶
- æœåŠ¡ç«¯è¿‡æ»¤å’Œåˆ†é¡µå¯è¿›ä¸€æ­¥æå‡æ€§èƒ½

### æ•°æ®ç®¡ç†
- ä½¿ç”¨ `onDataChange` å›è°ƒå®æ—¶åŒæ­¥æ•°æ®åˆ°åç«¯
- `changeInfo` å‚æ•°åŒ…å«è¯¦ç»†çš„å˜æ›´ä¿¡æ¯
- æ”¯æŒæ‰¹é‡æ›´æ–°ï¼ˆç²˜è´´å¤šä¸ªå•å…ƒæ ¼ï¼‰

### ç”¨æˆ·ä½“éªŒ
- å•å‡»ç¼–è¾‘ + è‡ªåŠ¨ä¿å­˜ï¼šé€‚åˆå¿«é€Ÿæ•°æ®å½•å…¥åœºæ™¯
- åŒå‡»ç¼–è¾‘ + ç¡®è®¤æŒ‰é’®ï¼šé€‚åˆéœ€è¦è°¨æ…ç¡®è®¤çš„åœºæ™¯
- å¯ç”¨æ–‘é©¬çº¹å’Œäº¤å‰é«˜äº®å¯æå‡å¯è¯»æ€§

## ğŸ”§ å¼€å‘

### æ„å»º

```bash
yarn build
# æˆ–
npm run build
```

### æ„å»º Storybook

```bash
yarn build-storybook
# æˆ–
npm run build-storybook
```

---

## ğŸ–¨ï¸ æ‰“å°è®¾è®¡å™¨ç»„ä»¶

### åŠŸèƒ½ç‰¹æ€§

1. **çº¸å¼ å°ºå¯¸æ”¯æŒ**
   - é¢„è®¾å°ºå¯¸ï¼šA4ã€A5ã€B5ã€Letter
   - è‡ªå®šä¹‰å°ºå¯¸
   - çºµå‘/æ¨ªå‘åˆ‡æ¢

2. **æ•°æ®ç»‘å®š**
   - æ”¯æŒ `{{fieldName}}` è¯­æ³•ç»‘å®šæ•°æ®
   - æ”¯æŒè®¡ç®—å…¬å¼ï¼š`{{qty}}*100+"å…ƒ"`
   - æ”¯æŒå­—æ®µæ‹¼æ¥ï¼š`{{price}}+"/"+"{{unit}}"`

3. **å¯è§†åŒ–è®¾è®¡**
   - æ‹–æ‹½è°ƒæ•´å…ƒç´ ä½ç½®
   - è°ƒæ•´å…ƒç´ å¤§å°
   - æ–‡æœ¬æ ·å¼è®¾ç½®ï¼ˆå­—ä½“ã€å¤§å°ã€é¢œè‰²ç­‰ï¼‰

### ä½¿ç”¨ç¤ºä¾‹

```tsx
import { PrintDesigner, type PrintTemplate } from './components/PrintDesigner';

const template: PrintTemplate = {
  name: 'äº§å“æ ‡ç­¾',
  paper: { size: 'A4', orientation: 'portrait' },
  elements: [
    {
      id: 'title',
      type: 'text',
      left: 20,
      top: 20,
      binding: '{{productName}}',
      fontSize: 20,
      fontWeight: 'bold',
    },
    {
      id: 'price',
      type: 'text',
      left: 20,
      top: 50,
      binding: '{{price}}+"å…ƒ"',
      fontSize: 16,
    },
  ],
};

const data = {
  productName: 'è‹¹æœæ‰‹æœº',
  price: 5999,
  qty: 100,
};

function App() {
  return (
    <PrintDesigner
      template={template}
      data={data}
      onTemplateChange={(newTemplate) => {
        console.log('æ¨¡æ¿å·²æ›´æ–°:', newTemplate);
      }}
      readOnly={false}
      showToolbar={true}
    />
  );
}
```

### æ•°æ®ç»‘å®šè¯­æ³•

| è¯­æ³• | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| ç®€å•ç»‘å®š | `{{productName}}` | ç›´æ¥æ˜¾ç¤ºå­—æ®µå€¼ |
| è®¡ç®— | `{{qty}}*100` | æ•°å€¼è®¡ç®— |
| æ‹¼æ¥ | `{{price}}+"å…ƒ"` | å­—ç¬¦ä¸²æ‹¼æ¥ |
| ç»„åˆ | `{{qty}}*100+"å…ƒ/ä»¶"` | è®¡ç®—åæ‹¼æ¥ |

### Props

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `template` | `PrintTemplate` | - | æ‰“å°æ¨¡æ¿ |
| `data` | `Record<string, any>` | `{}` | æ•°æ®æº |
| `onTemplateChange` | `(template: PrintTemplate) => void` | - | æ¨¡æ¿å˜æ›´å›è°ƒ |
| `readOnly` | `boolean` | `false` | åªè¯»æ¨¡å¼ |
| `showToolbar` | `boolean` | `true` | æ˜¾ç¤ºå·¥å…·æ  |

---

## ğŸ“„ License

MIT

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“® è”ç³»

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ Issue è”ç³»æˆ‘ä»¬ã€‚
